BootStrap: docker
From: python:3.10-slim

%environment
    export DATA_PATH=/data
    export PATH=/root/.local/bin:$PATH

%files
    uv.lock /code/uv.lock
    pyproject.toml /code/pyproject.toml
    src /code/src
    scripts /code/scripts
    README.md /code/README.md

%post
    export PATH=/root/.local/bin:$PATH
    apt-get update
    apt-get install --no-install-recommends curl -y
    mkdir /cargo
    curl -LsSf https://astral.sh/uv/install.sh | CARGO_HOME=/cargo sh
    mkdir /writeable

    # Add to bin to path
    echo "export PATH=/cargo/bin:\$PATH" >> $APPTAINER_ENVIRONMENT

    cd /code
    UV_PROJECT_ENVIRONMENT=/writeable/.venv uv sync --no-cache

%runscript
    cd /code
    uv --no-cache run $1

%labels
    Author Kieran Gibb
    Version 1.0
    Description "Run birdnetlib on files specified by an index parquet file"
